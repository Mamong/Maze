#  Maze Guide

基于prime算法修改生成迷宫图

## 概述

整个迷宫绘制流程包括配置，graph矩阵初始化，生成迷宫连接数据以及绘制迷宫。
```
//config
readConfig()

//init graph matrix
initGraph()

//generate maze connection data
generateMaze()

//draw maze
drawMaze()
```

## 详解
### 配置
相关代码：
```
rowNum = 10
colNum = 10

entrance = 2
exit = 1

canvasWidth = 320
canvasHeight = 320
margin = 10
```
可配置迷宫的行数和列数（把迷宫看成一个个小方块组成的），指定迷宫的入口和出口（1-left 2-bottom 3-right 4-top），指定绘制区域的大小（canvasWidth和canvasHeight），指定绘制开始区域开始的距离margin。

### 初始化graph矩阵
graph矩阵记录了每个方块和其他方块之间的关系，以下以10X10规格为例，graph是一个100x100的矩阵。方块之间的关系可以描述为三种：0 - not a neighbor; 1 - unconnected neighbor; 2 - connected neighbor。一个方块必定和上下左右四个方块是邻居，除此之外的都不是邻居。在邻居的基础上，方块还可能和邻居是连通的，也就是connected。初始化时候，我们先初始化一个100x100的全0矩阵，然后对相邻的方块标记为1。

### 生成迷宫连接数据
前面我们已经生成了一个10x10个格子，互不连通的迷宫，我们现在要确保迷宫中的每个格子都能和其他任一格子连通，这样就确保了出口和入口间必定有通路。

我们首先假设有个移动的小人放在迷宫中央，并把这个小人所占的格子加入到迷宫通路的数组inList里，并且把这个格子周围四个格子放到迷宫前沿数组frontierList里。这就是generateMaze中locateStartingCell方法做的事情。

然后我们每次检查inList是不是把所有的格子都加进来，也就是检查下个数是否等于10x10。如果不是的话，就从前沿数组里随机取出一个，然后放到迷宫数组里。接着通过carveIntoMazeAndAddNeighbors将加入到迷宫数组的格子跟目前的迷宫通路连接起来。这是个关键的步骤，怎么连接呢？我们先要遍历所有的格子，看看哪些是和这个新加入的格子是相邻的，并且已经在迷宫数组里，并把它们放到tempList中。同时要把那些不在迷宫数组里的邻居，加入到frontierList里，因为这个格子加入到迷宫后，它的邻居们也成为了迷宫的前沿。接着从tempList中随机选一个和新加入的cell连通，也就是将它们的关系设为2。当然我们要确保前沿格子不被重复加入。


### 绘制迷宫
迷宫绘制包括两部分：绘制迷宫的四个边界和绘制内部的分隔线。绘制边界的时候，我们先移动我们的“画笔”到左上角，然后判断左侧的边界是不是迷宫的出口或者入口，如果不是，那么直接从上到下画一条rowNum个单位长度的线。如果是出入口，则先画rowNum/2个单位长度的线，然后跳过一个单位，接着画剩下（rowNum-1）/2个单位的线。然后类似地，从左往右，从下往上，从右往左依次画边界，这是一个逆时针的顺序，最终我们回到了起点。

绘制内部的分隔线时，我们先绘制所有的垂直分割线，从上往下，从左往右的顺序进行。当一个格子和右侧一个格子的关系是邻居而不连通的时候，就绘制垂直分隔线。每次绘制的时候，就先移动到下一个格子的左上角，然后向下绘制一个单位长度的线。

接着绘制所有的水平分割线，从上往下，从左往右的顺序进行。当一个格子和下面一个格子的关系是邻居而不连通的时候，就绘制水平分割线。每次绘制的时候，就先移动到下一个格子的左下角，然后向右绘制一个单位长度的线。

绘制过程是先生成一个CGMutablePath，然后把过程中绘制的各个部分都拼接进去，最终绘制成一张图片。

## screenshot
![](https://raw.githubusercontent.com/Mamong/Maze/master/1.png)
